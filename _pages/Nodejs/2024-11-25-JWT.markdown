---
title: JWT(Json Web Token)
date: 2024-11-25 00:00:00
categories: [Node.js, JWT]
tags:
  [
    Node.js, λΌμ΄λΈλ¬λ¦¬
  ]
---

# JWT(Json Web Token)
---
μ›Ή ν‘μ¤€μΌλ΅μ¨, μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ μ‚¬μ΄μ—μ„ μ •λ³΄λ¥Ό μ•μ „ν•κ² μ „μ†΅ν•κΈ° μ„ν•΄ λ„μ›€μ„ μ£Όλ” μ›Ή ν† ν°(Web Token).
  - SON ν•νƒμ λ°μ΄ν„°λ¥Ό μ•μ „ν•κ² μ „μ†΅ν•κ³  κ²€μ¦ν•  μ μλ” κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤.
  - μΈν„°λ„· ν‘μ¤€μΌλ΅μ„ μλ¦¬μ΅μ€ κ·κ²©μ…λ‹λ‹¤.
  - λ‹¤μ–‘ν• μ•”νΈν™” μ•κ³ λ¦¬μ¦μ„ μ‚¬μ©ν•  μ μμ–΄, μ‹ λΆ°μ„±μ„ λ³΄μ¥ν•©λ‹λ‹¤.
  - `header**.**payload**.**signature` μ ν•μ‹μΌλ΅ 3κ°€μ§€μ λ°μ΄ν„°λ¥Ό ν¬ν•¨ν•©λ‹λ‹¤. (κ°λ―Έμ²λΌ λ¨Έλ¦¬, κ°€μ΄, λ°°)  
      β†’ λ•λ¬Έμ—, JWT ν•μ‹μΌλ΅ λ³€ν™ λ λ°μ΄ν„°λ” ν•­μƒ 2κ°μ `.` μ΄ ν¬ν•¨λ λ°μ΄ν„°μ—¬μ•Ό ν•©λ‹λ‹¤.

Header(λ¨Έλ¦¬): ν—¤λ”λ” ν† ν°μ νƒ€μ…κ³Ό μ–΄λ–¤ μ•”νΈν™”λ¥Ό μ‚¬μ©ν•μ—¬ μƒμ„±λ λ°μ΄ν„°μΈμ§€ μ •μλμ–΄ μμµλ‹λ‹¤.

```json
{
  "alg": "HS256",
  "typ": "JWT"
}
β€‹```

Payload(κ°€μ΄): νμ΄λ΅λ“λ” μ‹¤μ  μ „λ‹¬ν•λ ¤λ” λ°μ΄ν„°λ¥Ό λ‹΄κ³  μμµλ‹λ‹¤. λ€ν‘μ μΌλ΅ κ°λ°μκ°€ μ›ν•λ” λ°μ΄ν„°λ¥Ό μ €μ¥ν•©λ‹λ‹¤.

```json
{
  "sub": "1234567890",
  "name": "John Doe",
  "iat": 1516239022
}
β€‹```

Signature(λ°°): μ„λ…μ€ ν—¤λ”μ™€ νμ΄λ΅λ“, κ·Έλ¦¬κ³  λΉ„λ°€ ν‚¤(Secret Key)λ¥Ό μ΄μ©ν•μ—¬ μƒμ„±λ©λ‹λ‹¤. μ΄ μ„λ…μ€ ν† ν°μ΄ λ³€μ΅°λμ§€ μ•μ€ μ •μƒμ μΈ ν† ν°μΈμ§€ ν™•μΈν•  μ μκ² λ„μ™€μ¤λ‹λ‹¤.

```javascript
HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
	secret
)
```

κ° λ¶€λ¶„μ„ Base64λ΅ μΈμ½”λ”©ν•μ—¬, μ (.) μΌλ΅ μ—°κ²°ν•λ©΄ μµμΆ…μ μΌλ΅ JWTλ¥Ό μƒμ„±ν•κ² λλ‹¤. μ΄λ ‡κ² μƒμ„±λ JWTλ” μ΄μ „μ— λ°°μ΄ μΏ ν‚¤(Cookie) λλ” Path Parameterλ¥Ό ν†µν•΄ μ „λ‹¬λ  μ μλ‹¤.

#### νΉμ„±
---
1. JWTλ” **λΉ„λ°€ ν‚¤**λ¥Ό λ¨λ¥΄λ”λΌλ„ **λ³µνΈν™”(Decode)**κ°€ κ°€λ¥ν•©λ‹λ‹¤.
    - **JWTλ¥Ό κ°€μ§„ μ‚¬λμ΄λΌλ©΄ λ„κµ¬λ‚** ν•΄λ‹Ή ν† ν°μ— μ–΄λ–¤ λ°μ΄ν„°κ°€ λ‹΄κ²¨μλ”μ§€ ν™•μΈν•  μ μμµλ‹λ‹¤.
    - λ³€μ΅°λ§ λ¶κ°€λ¥ ν•  λΏ, **λ„κµ¬λ‚ λ³µνΈν™”**ν•μ—¬ λ³΄λ”κ²ƒμ€ κ°€λ¥ν•λ‹¤λ” μλ―Έκ°€ λ©λ‹λ‹¤!
2. **λ―Όκ°ν• μ •λ³΄(κ°μΈμ •λ³΄, λΉ„λ°€λ²νΈ λ“±)**λ” λ‹΄μ§€ μ•λ„λ΅ ν•΄μ•Όν•©λ‹λ‹¤.
    - JWTμ νμ΄λ΅λ“λ” **λ„κµ¬λ‚ λ³µνΈν™”ν•μ—¬ λ³Ό μ μκΈ°** λ•λ¬Έμ…λ‹λ‹¤.
3. JavaScriptμ™€ κ°™μ΄ **νΉμ • μ–Έμ–΄μ—μ„λ§ μ‚¬μ© κ°€λ¥ν•κ²ƒμ€ μ•„λ‹™λ‹λ‹¤!**
    - JWTλ” λ‹¨μν **λ°μ΄ν„° ν•μ‹**μΌ λΏ, λ‹¨μ§€ κ°λ…μΌλ΅μ„ μ΅΄μ¬ν•κ³ , μ΄ κ°λ…μ„ μ½”λ“λ΅ κµ¬ν„ν•μ—¬ κ³µκ°λ μ½”λ“λ¥Ό μ°λ¦¬κ°€ μ‚¬μ©ν•λ”κ² μΌλ°μ μ…λ‹λ‹¤.

#### μΏ ν‚¤/μ„Έμ…κ³Ό μ°¨μ΄
---
λ°μ΄ν„°λ¥Ό κµν™ν•κ³  κ΄€λ¦¬ν•λ” λ°©μ‹μΈ μΏ ν‚¤/μ„Έμ…κ³Ό λ‹¬λ¦¬, JWTλ” λ‹¨μν λ°μ΄ν„°λ¥Ό ν‘ν„ν•λ” ν•μ‹.
  - **JWTλ΅ λ§λ“  λ°μ΄ν„°**λ” **λ³€μ΅°κ°€ μ–΄λ µκ³ **, μ„λ²„μ— λ³„λ„μ μƒνƒ μ •λ³΄λ¥Ό μ €μ¥ν•μ§€ μ•κΈ° λ•λ¬Έμ—, μ„λ²„λ¥Ό **Stateless(λ¬΄μƒνƒ)**λ΅ κ΄€λ¦¬ν•  μ μμµλ‹λ‹¤.
  - **μΏ ν‚¤μ™€ μ„Έμ…**μ€ μ‚¬μ©μμ λ΅κ·ΈμΈ μ •λ³΄λ‚ μ„Έμ… λ°μ΄ν„°λ¥Ό **μ„λ²„μ— μ €μ¥**ν•λ―€λ΅ μƒνƒλ¥Ό μ μ§€ν•©λ‹λ‹¤. λ•λ¬Έμ—, **Stateful(μƒνƒ λ³΄μ΅΄)**ν•κ² λ°μ΄ν„°κ°€ κ΄€λ¦¬λ©λ‹λ‹¤.
  - **Stateless(λ¬΄μƒνƒ)**μ™€ **Stateful(μƒνƒ λ³΄μ΅΄)**μ μ°¨μ΄λ¥Ό κ°„λ‹¨ν μ„¤λ…ν•μλ©΄,
  Node.js μ„λ²„κ°€ μ–Έμ λ“  μ£½μ—λ‹¤ μ‚΄μ•„λ‚λ„ **λ‘κ°™μ€ λ™μ‘**μ„ ν•λ©΄ **Stateless**ν•λ‹¤κ³  λ³Ό μ μμµλ‹λ‹¤.
  λ°λ€λ΅ μ„λ²„κ°€ μ£½μ—λ‹¤ μ‚΄μ•„λ‚¬μ„λ• μ΅°κΈμ΄λΌλ„ **λ™μ‘μ΄ λ‹¤λ¥Έ** κ²½μ° **Stateful**ν•λ‹¤κ³  λ³Ό μ μκ² μ£ .
  - μ„λ²„κ°€ **μ¤μ¤λ΅** μ–΄λ–¤ κΈ°μ–µμ„ κ°–κ³  λ‹¤λ¥Έ κ²°μ •μ„ ν•λƒ λ§λƒμ μ°¨μ΄λΌκ³  λ³΄λ©΄ λ” μ‰½μµλ‹λ‹¤ π‰
  - λ΅κ·ΈμΈ μ •λ³΄λ¥Ό **μ„λ²„μ— μ €μ¥**ν•κ² λλ©΄ λ¬΄μ΅°κ±΄ **Stateful(μƒνƒ λ³΄μ΅΄)**μ΄λΌκ³  λ³Ό μ μμ£ !

#### μ„¤μΉ
---

```bash
# jsonwebtoken, express λΌμ΄λΈλ¬λ¦¬λ¥Ό μ„¤μΉν•©λ‹λ‹¤.
yarn add jsonwebtoken express
```

#### μ‚¬μ©λ²•
---
1. μ•”νΈν™”

```javascript
import jwt from 'jsonwebtoken';

const token = jwt.sign({ myPayloadData: 1234 }, 'mysecretkey');
console.log(token);
```

2. λ³µνΈν™”

```javascript
import jwt from 'jsonwebtoken';

const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJteVBheWxvYWREYXRhIjoxMjM0LCJpYXQiOjE2OTA4NzM4ODV9.YUmYY9aef9HOO8f2d6Umh2gtWRXJjDkzjm5FPhsQEA0";
const decodedValue = jwt.decode(token);

console.log(decodedValue); 
```

3. κ²€μ¦

```javascript
import jwt from 'jsonwebtoken';

const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJteVBheWxvYWREYXRhIjoxMjM0LCJpYXQiOjE2OTA4NzM4ODV9.YUmYY9aef9HOO8f2d6Umh2gtWRXJjDkzjm5FPhsQEA0";
const decodedValueByVerify = jwt.verify(token, "mysecretkey");

console.log(decodedValueByVerify);
```

Invalid Signature μ—λ¬ λ°μƒ
![μ¤λ¥ λ°μƒ](https://teamsparta.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F0c2b8749-8b4c-4676-bd02-417acb6c3cae%2F%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-08-01_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_4.18.05.png?table=block&id=671bcca6-9ccb-4d90-b185-c74443b60182&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=1300&userId=&cache=v2)